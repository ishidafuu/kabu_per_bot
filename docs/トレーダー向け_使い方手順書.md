# kabu_per_bot 管理画面 使い方手順書

最終更新: 2026-02-15（JST）

この手順書は管理画面の `使い方` ページ（`/guide`）と同等内容です。

## 1. 利用前の準備

1. 管理画面URLへアクセスします: `https://kabu-per-bot-487501.web.app`
2. Firebase Authentication に登録済みのメールアドレス/パスワードを用意します。
3. 通知先の Discord Webhook は運用担当側で設定済みであることを確認します。

## 2. ログイン

1. ログイン画面でメールアドレスとパスワードを入力し、「Firebaseでログイン」を押します。
2. ログイン成功後、ダッシュボード画面へ遷移します。
3. 認証に失敗する場合は、入力値または Firebase Auth のユーザー登録状態を確認します。

## 3. ダッシュボードの見方

1. 監視銘柄数: 現在の有効なウォッチリスト登録件数です。
2. 当日通知件数: 当日JSTの PER/PSR 通知件数です。
3. データ不明件数: EPS/売上/決算日欠損により送られた通知件数です。
4. 失敗ジョブ有無: 当日JSTの決算ジョブ失敗が1件でもあれば「あり」です。
5. 表示が古い場合は「再読み込み」を押してください。

## 4. ウォッチリスト登録

1. 「ウォッチリストへ」から管理画面を開き、「新規追加」を押します。
2. ticker は必ず `1234:TSE` 形式で入力します（例: `7203:TSE`）。
3. `metric_type` は `PER` または `PSR` を選択します。
4. `notify_channel` は `DISCORD` または `OFF` を選択します。
5. `notify_timing` は `IMMEDIATE` / `AT_21` / `OFF` を選択します。
6. 入力後に保存すると一覧へ反映されます（最大100件）。

## 5. ウォッチリスト編集・削除

1. 対象行の「編集」で設定変更できます。
2. 対象行の「削除」で監視対象から除外できます。
3. 削除実行時は確認ダイアログが表示されます。
4. 追加・削除の操作は履歴画面で確認できます。

## 6. 履歴・通知ログの確認

1. 履歴タブでは `ADD/REMOVE` の操作履歴を時系列で確認できます。
2. 通知ログタブでは送信済み通知を時系列で確認できます。
3. いずれも ticker で絞り込み検索が可能です。
4. 日時表示は JST 基準です。

## 7. 通知タイミングの運用ルール

1. `IMMEDIATE`: 日次ジョブ側で通知対象になります。
2. `AT_21`: 21時系の通知ジョブ側で通知対象になります。
3. `OFF`: 通知送信対象外です。
4. 同一条件通知は2時間クールダウンで重複抑制されます。

## 8. 既知事項

1. AI通知は現時点で未実装です（画面上にも未実装表示あり）。
2. 通知チャネルは Discord のみ対応です。

## 9. トラブル時の確認ポイント

1. 「APIに接続できません」が出る場合: ブラウザをハードリロード後に再ログインします。
2. それでも改善しない場合: API URL設定、Cloud Run公開設定、CORS設定を確認します。
3. データが出ない場合: ticker形式、検索条件、該当データの有無を確認します。
