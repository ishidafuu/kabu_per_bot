# Web管理画面 実装タスク（Issue粒度）

## 0. 前提

- バックエンドは Python（FastAPI）で実装する
- 画面は React + TypeScript（Vite）で実装する
- 認証は Firebase Authentication を使用する
- 仕様の正本:
  - `/Users/ishidafuu/Documents/repository/kabu_per_bot/docs/Web管理画面_仕様（画面一覧・API一覧）.md`

## 1. マイルストーン（Web）

1. W1: API基盤と認証
2. W2: ウォッチリストAPIと画面
3. W3: ダッシュボード・履歴・通知ログ
4. W4: テスト・運用整備

## 2. Issue一覧（起票用）

### W01: FastAPIプロジェクト雛形を作成する

- 目的: Web API実装の土台を整える
- スコープ:
  - `api/` ディレクトリ作成
  - FastAPI起動エントリポイント
  - ルーティング基本構造（`/api/v1`）
- 受け入れ基準:
  - `GET /api/v1/healthz` が `200 {"status":"ok"}` を返す
- 依存: Issue 01

### W02: Firebase Authトークン検証ミドルウェアを実装する

- 目的: API保護を有効化する
- スコープ:
  - AuthorizationヘッダのBearerトークン検証
  - 未認証時 `401`、権限不足時 `403`
- 受け入れ基準:
  - 認証なしで保護APIにアクセスすると `401`
  - 有効トークンでアクセスすると `200`
- 依存: W01

### W03: ウォッチリストAPI（GET一覧/GET詳細）を実装する

- 目的: 管理画面の読取系APIを提供する
- スコープ:
  - `GET /api/v1/watchlist`
  - `GET /api/v1/watchlist/{ticker}`
  - クエリ `q/limit/offset`（一覧）
- 受け入れ基準:
  - 登録済みデータが一覧/詳細で取得できる
  - 未登録tickerで `404`
- 依存: W02, Issue 03

### W04: ウォッチリストAPI（POST/PATCH/DELETE）を実装する

- 目的: 管理画面の更新系APIを提供する
- スコープ:
  - `POST /api/v1/watchlist`
  - `PATCH /api/v1/watchlist/{ticker}`
  - `DELETE /api/v1/watchlist/{ticker}`
  - 100件上限、重複、入力バリデーション
- 受け入れ基準:
  - 101件目追加で `429`
  - 重複追加で `409`
  - 更新後再取得で値が反映される
- 依存: W03, Issue 03

### W05: OpenAPIスキーマとエラー共通レスポンスを整備する

- 目的: フロント連携を安定化する
- スコープ:
  - リクエスト/レスポンスモデル定義
  - エラーコード `400/401/403/404/409/422/429/500` の統一
- 受け入れ基準:
  - `/docs` 上で全API仕様が確認できる
  - エラー形式が全エンドポイントで一致する
- 依存: W04

### W06: フロントプロジェクト（React+TS+Vite）を作成する

- 目的: Web画面実装の土台を整える
- スコープ:
  - `web/` ディレクトリ作成
  - ルーティング・HTTPクライアント・環境変数設定
  - Firebase Hosting向けビルド設定
- 受け入れ基準:
  - ローカルで画面が起動できる
  - APIベースURLを環境変数で切替可能
- 依存: なし

### W07: ログイン画面を実装する

- 目的: Web画面の認証導線を実装する
- スコープ:
  - Firebase Authログイン
  - ログイン後ダッシュボード遷移
  - ログアウト導線
- 受け入れ基準:
  - 未ログイン時に保護画面へ入れない
  - ログイン成功で保護画面へ遷移する
- 依存: W06, W02

### W08: ウォッチリスト一覧画面を実装する

- 目的: 監視銘柄の閲覧・検索を可能にする
- スコープ:
  - 一覧テーブル表示
  - ticker/name検索
  - ページング（limit/offset）
- 受け入れ基準:
  - API結果が一覧に反映される
  - 検索条件で表示が絞り込まれる
- 依存: W07, W03

### W09: ウォッチリスト作成/編集/削除UIを実装する

- 目的: 監視銘柄の操作を画面で完結させる
- スコープ:
  - 作成フォーム（POST）
  - 編集フォーム（PATCH）
  - 削除アクション（DELETE）
  - APIエラー表示（409/422/429）
- 受け入れ基準:
  - 追加・更新・削除が画面上で完了する
  - 101件目追加時に上限エラーが表示される
- 依存: W08, W04

### W10: ダッシュボード最小版を実装する

- 目的: 運用状況の可視化を行う
- スコープ:
  - 監視銘柄数表示
  - 当日通知件数表示
  - 直近失敗ジョブ表示（取得可能な範囲で）
- 受け入れ基準:
  - ダッシュボードで主要KPIが確認できる
- 依存: W07, Issue 17

### W11: 履歴画面/通知ログ画面を実装する

- 目的: 操作履歴と通知履歴の追跡を可能にする
- スコープ:
  - 監視履歴画面
  - 通知ログ画面
- 受け入れ基準:
  - 履歴と通知ログが時系列で閲覧できる
- 依存: W07, Issue 04, Issue 17

### W12: Web E2Eテストとデプロイ手順を整備する

- 目的: Web運用の再現性を確保する
- スコープ:
  - API結合テスト（主要導線）
  - UI E2Eテスト（ログイン、一覧、CRUD）
  - Firebase Hosting / Cloud Run デプロイ手順
- 受け入れ基準:
  - 主要導線のE2EがCIまたはローカルで再現可能
  - 手順どおりにステージング反映できる
- 依存: W05, W09, W10, W11

## 3. 起票テンプレート（Web）

```md
## 概要

## 背景/目的

## スコープ
- 

## 受け入れ基準
- [ ] 

## 依存Issue
- #
```

